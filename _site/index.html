<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Solar Theme</title>
		<meta name="viewport" content="width=device-width">

		<!--[if lt IE 9]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link href="/assets/css/style.css" rel="stylesheet" />
		<link href="/assets/css/colors-dark.css" rel="stylesheet" />
	</head>

	<body>
		<header id="header">
			<h1><a href="/"><i class="icon-sun"></i> Mike Hoffert</a></h1>
			<p>Personal information for Michael Hoffert with work experience.</p>
		</header>

		<div id="page">
			<div id="sidebar">
				<nav>
					<ul>
						<li><a href="/">Home</a></li>
						<li><a href="/game">Game</a></li>
						<li><a href="/about">About</a></li>
						<li><a href="http://github.com/mahcloud" target="_blank">GitHub</a></li>
						<li><a href="http://twitter.com/mahcloud" target="_blank">Twitter</a></li>
						<li><a href="http://facebook.com/ff7heaven" target="_blank">Facebook</a></li>
						<li><a href="/feed.xml">RSS Feed</a></li>
					</ul>
				</nav>
			</div>

			<div id="content">
				
	<article class="post">
		
			<h1><a href="/2014/06/17/postges-config/">Chef - Server Provisioning Software</a></h1>
		
		<div class="post-content"><p>I’m trying to run capistrano to deploy a code base. When I run capistrano, it fails to install gem pg because of the following</p>

<div class="highlight"><pre><code class="bash">rake aborted!
DEBUG <span class="o">[]</span> 	PG::ConnectionBad: FATAL:  no pg_hba.conf entry <span class="k">for </span>host <span class="s2">&quot;0.0.0.0&quot;</span>, user <span class="s2">&quot;postgres&quot;</span>, database <span class="s2">&quot;slice&quot;</span>, SSL on
DEBUG <span class="o">[]</span> 	FATAL:  no pg_hba.conf entry <span class="k">for </span>host <span class="s2">&quot;0.0.0.0&quot;</span>, user <span class="s2">&quot;postgres&quot;</span>, database <span class="s2">&quot;slice&quot;</span>, SSL off
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/postgresql_adapter.rb:831:in <span class="sb">`</span>initialize<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/postgresql_adapter.rb:831:in `new&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/postgresql_adapter.rb:831:in <span class="sb">`</span>connect<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/postgresql_adapter.rb:548:in `initialize&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/postgresql_adapter.rb:41:in <span class="sb">`</span>new<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/postgresql_adapter.rb:41:in `postgresql_connection&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:440:in <span class="sb">`</span>new_connection<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:450:in `checkout_new_connection&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:421:in <span class="sb">`</span>acquire_connection<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:356:in `block in checkout&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:355:in <span class="sb">`</span>checkout<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:265:in `block in connection&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:264:in <span class="sb">`</span>connection<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_adapters/abstract/connection_pool.rb:546:in `retrieve_connection&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_handling.rb:79:in <span class="sb">`</span>retrieve_connection<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/connection_handling.rb:53:in `connection&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/migration.rb:863:in <span class="sb">`</span>initialize<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/migration.rb:764:in `new&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/migration.rb:764:in <span class="sb">`</span>up<span class="s1">&#39;</span>
<span class="s1">DEBUG [] 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/migration.rb:742:in `migrate&#39;</span>
DEBUG <span class="o">[]</span> 	/home/deploy/slice/shared/bundle/ruby/2.1.0/gems/activerecord-4.0.3/lib/active_record/railties/databases.rake:42:in <span class="sb">`</span>block <span class="o">(</span>2 levels<span class="o">)</span> in &lt;top <span class="o">(</span>required<span class="o">)</span>&gt;<span class="err">&#39;</span>
DEBUG <span class="o">[]</span> 	Tasks: <span class="nv">TOP</span> <span class="o">=</span>&gt; db:migrate
DEBUG <span class="o">[]</span> 	<span class="o">(</span>See full trace by running task with --trace<span class="o">)</span>
cap aborted!
SSHKit::Command::Failed: rake <span class="nb">exit </span>status: 1
rake stdout: Nothing written
rake stderr: rake aborted!
PG::ConnectionBad: FATAL:  no pg_hba.conf entry <span class="k">for </span>host <span class="s2">&quot;0.0.0.0&quot;</span>, user <span class="s2">&quot;postgres&quot;</span>, database <span class="s2">&quot;slice&quot;</span>, SSL on
FATAL:  no pg_hba.conf entry <span class="k">for </span>host <span class="s2">&quot;0.0.0.0&quot;</span>, user <span class="s2">&quot;postgres&quot;</span>, database <span class="s2">&quot;slice&quot;</span>, SSL off</code></pre></div>

<p>The pg_hba.conf file is generated when pg is is installed. The only problem is that I don’t want postgres installed on that server. I want the application to communicate with another server that hosts the postgres database so that I can have multiple application servers accessing the same database. So, since I’m not installing postgres, the config file is not being created. I could run <code>gem install pg --without-pg_config</code>, but then I wouldn’t be able to run capistrano. The <a href="http://www.postgresql.org/docs/8.3/static/auth-pg-hba-conf.html">pg_hba</a> file is described as a configuration file for client authentication. At first I thought this file needed to be created on the application side, but the application side actually is looking for this file on the postgres server. So, this file needs to be on the postgres server at /etc/postgresql/VERSION/main/pg_hba.conf</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># PostgreSQL Client Authentication Configuration File</span>
<span class="c1"># ===================================================</span>
<span class="c1">#</span>
<span class="c1"># Refer to the &quot;Client Authentication&quot; section in the PostgreSQL</span>
<span class="c1"># documentation for a complete description of this file.  A short</span>
<span class="c1"># synopsis follows.</span>
<span class="c1">#</span>
<span class="c1"># This file controls: which hosts are allowed to connect, how clients</span>
<span class="c1"># are authenticated, which PostgreSQL user names they can use, which</span>
<span class="c1"># databases they can access.  Records take one of these forms:</span>
<span class="c1">#</span>
<span class="c1"># local      DATABASE  USER  METHOD  [OPTIONS]</span>
<span class="c1"># host       DATABASE  USER  ADDRESS  METHOD  [OPTIONS]</span>
<span class="c1"># hostssl    DATABASE  USER  ADDRESS  METHOD  [OPTIONS]</span>
<span class="c1"># hostnossl  DATABASE  USER  ADDRESS  METHOD  [OPTIONS]</span>
<span class="c1">#</span>
<span class="c1"># (The uppercase items must be replaced by actual values.)</span>
<span class="c1">#</span>
<span class="c1"># The first field is the connection type: &quot;local&quot; is a Unix-domain</span>
<span class="c1"># socket, &quot;host&quot; is either a plain or SSL-encrypted TCP/IP socket,</span>
<span class="c1"># &quot;hostssl&quot; is an SSL-encrypted TCP/IP socket, and &quot;hostnossl&quot; is a</span>
<span class="c1"># plain TCP/IP socket.</span>
<span class="c1">#</span>
<span class="c1"># DATABASE can be &quot;all&quot;, &quot;sameuser&quot;, &quot;samerole&quot;, &quot;replication&quot;, a</span>
<span class="c1"># database name, or a comma-separated list thereof. The &quot;all&quot;</span>
<span class="c1"># keyword does not match &quot;replication&quot;. Access to replication</span>
<span class="c1"># must be enabled in a separate record (see example below).</span>
<span class="c1">#</span>
<span class="c1"># USER can be &quot;all&quot;, a user name, a group name prefixed with &quot;+&quot;, or a</span>
<span class="c1"># comma-separated list thereof.  In both the DATABASE and USER fields</span>
<span class="c1"># you can also write a file name prefixed with &quot;@&quot; to include names</span>
<span class="c1"># from a separate file.</span>
<span class="c1">#</span>
<span class="c1"># ADDRESS specifies the set of hosts the record matches.  It can be a</span>
<span class="c1"># host name, or it is made up of an IP address and a CIDR mask that is</span>
<span class="c1"># an integer (between 0 and 32 (IPv4) or 128 (IPv6) inclusive) that</span>
<span class="c1"># specifies the number of significant bits in the mask.  A host name</span>
<span class="c1"># that starts with a dot (.) matches a suffix of the actual host name.</span>
<span class="c1"># Alternatively, you can write an IP address and netmask in separate</span>
<span class="c1"># columns to specify the set of hosts.  Instead of a CIDR-address, you</span>
<span class="c1"># can write &quot;samehost&quot; to match any of the server&#39;s own IP addresses,</span>
<span class="c1"># or &quot;samenet&quot; to match any address in any subnet that the server is</span>
<span class="c1"># directly connected to.</span>
<span class="c1">#</span>
<span class="c1"># METHOD can be &quot;trust&quot;, &quot;reject&quot;, &quot;md5&quot;, &quot;password&quot;, &quot;gss&quot;, &quot;sspi&quot;,</span>
<span class="c1"># &quot;krb5&quot;, &quot;ident&quot;, &quot;peer&quot;, &quot;pam&quot;, &quot;ldap&quot;, &quot;radius&quot; or &quot;cert&quot;.  Note that</span>
<span class="c1"># &quot;password&quot; sends passwords in clear text; &quot;md5&quot; is preferred since</span>
<span class="c1"># it sends encrypted passwords.</span>
<span class="c1">#</span>
<span class="c1"># OPTIONS are a set of options for the authentication in the format</span>
<span class="c1"># NAME=VALUE.  The available options depend on the different</span>
<span class="c1"># authentication methods -- refer to the &quot;Client Authentication&quot;</span>
<span class="c1"># section in the documentation for a list of which options are</span>
<span class="c1"># available for which authentication methods.</span>
<span class="c1">#</span>
<span class="c1"># Database and user names containing spaces, commas, quotes and other</span>
<span class="c1"># special characters must be quoted.  Quoting one of the keywords</span>
<span class="c1"># &quot;all&quot;, &quot;sameuser&quot;, &quot;samerole&quot; or &quot;replication&quot; makes the name lose</span>
<span class="c1"># its special character, and just match a database or username with</span>
<span class="c1"># that name.</span>
<span class="c1">#</span>
<span class="c1"># This file is read on server startup and when the postmaster receives</span>
<span class="c1"># a SIGHUP signal.  If you edit the file on a running system, you have</span>
<span class="c1"># to SIGHUP the postmaster for the changes to take effect.  You can</span>
<span class="c1"># use &quot;pg_ctl reload&quot; to do that.</span>

<span class="c1"># Put your actual configuration here</span>
<span class="c1"># ----------------------------------</span>
<span class="c1">#</span>
<span class="c1"># If you want to allow non-local connections, you need to add more</span>
<span class="c1"># &quot;host&quot; records.  In that case you will also need to make PostgreSQL</span>
<span class="c1"># listen on a non-local interface via the listen_addresses</span>
<span class="c1"># configuration parameter, or via the -i or -h command line switches.</span>




<span class="c1"># DO NOT DISABLE!</span>
<span class="c1"># If you change this first entry you will need to make sure that the</span>
<span class="c1"># database superuser can access the database using some other method.</span>
<span class="c1"># Noninteractive access to all databases is required during automatic</span>
<span class="c1"># maintenance (custom daily cronjobs, replication, and similar tasks).</span>
<span class="c1">#</span>
<span class="c1"># Database administrative login by Unix domain socket</span>
<span class="n">local</span>   <span class="n">all</span>             <span class="n">postgres</span>                                <span class="n">peer</span>

<span class="c1"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>

<span class="c1"># &quot;local&quot; is for Unix domain socket connections only</span>
<span class="n">local</span>   <span class="n">all</span>             <span class="n">all</span>                                     <span class="n">peer</span>
<span class="c1"># IPv4 local connections:</span>
<span class="n">host</span>    <span class="n">all</span>             <span class="n">all</span>             <span class="no">APPLICATION_IP</span><span class="o">/</span><span class="mi">32</span>            <span class="n">md5</span>
<span class="c1"># IPv6 local connections:</span>
<span class="n">host</span>    <span class="n">all</span>             <span class="n">all</span>             <span class="o">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span>                 <span class="n">md5</span>
<span class="c1"># Allow replication connections from localhost, by a user with the</span>
<span class="c1"># replication privilege.</span>
<span class="c1">#local   replication     postgres                                peer</span>
<span class="c1">#host    replication     postgres        127.0.0.1/32            md5</span>
<span class="c1">#host    replication     postgres        ::1/128                 md5</span></code></pre></div>

<p>The important line is the APPLICATION_IP that tells your postgres server where it will accept traffic from. Most of the other lines are just comments. [pg_hba_configure][Here] is another for customizing that configuration file.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/06/17/chef-bundle-install/">Chef - Server Provisioning Software</a></h1>
		
		<div class="post-content"><p>So, I got to the point where I wanted a clean slate so I reformatted and started my mac over with a clean install.
I’m setting up things that I haven’t configured in a long time.
It’s good for my memory though.</p>

<p>Problem #1
I’m running</p>

<div class="highlight"><pre><code class="bash">bundle install</code></pre></div>

<p>on ruby version 1.9.2 for a chef repository. It seems to have a problem installing the nokogiri gem. <a href="https://github.com/sparklemotion/nokogiri">Nokogiri</a> is a HTML, XML, SAX, and Reader parser.</p>

<div class="highlight"><pre><code class="bash">bundle install
Fetching gem metadata from https://rubygems.org/.......
Fetching additional metadata from https://rubygems.org/..
Using rake 10.3.1
Using builder 3.2.2
Using gyoku 1.1.1
Using mini_portile 0.5.3
sh: -c: line 0: unexpected EOF <span class="k">while </span>looking <span class="k">for </span>matching <span class="sb">`</span><span class="s2">&quot;&#39;</span>
<span class="s2">sh: -c: line 1: syntax error: unexpected end of file</span>

<span class="s2">Gem::Ext::BuildError: ERROR: Failed to build gem native extension.</span>

<span class="s2">    /Users/mahcloud/.rvm/rubies/ruby-1.9.2-p320/bin/ruby extconf.rb &quot;</span>--with-xml2-include<span class="o">=</span>/usr/local/Cellar/libxml2/2.7.8/include/libxml2 --with-xml2-lib<span class="o">=</span>/usr/local/Cellar/libxml2/2.7.8/lib --with-xslt-dir<span class="o">=</span>/usr/local/Cellar

extconf failed, <span class="nb">exit </span>code 2

Gem files will remain installed in /Users/mahcloud/.rvm/gems/ruby-1.9.2-p320@1kb-chef/gems/nokogiri-1.6.2 <span class="k">for </span>inspection.
Results logged to /Users/mahcloud/.rvm/gems/ruby-1.9.2-p320@1kb-chef/extensions/x86_64-darwin-13/1.9.1/nokogiri-1.6.2/gem_make.out
An error occurred <span class="k">while </span>installing nokogiri <span class="o">(</span>1.6.2<span class="o">)</span>, and Bundler cannot <span class="k">continue</span>.
Make sure that <span class="sb">`</span>gem install nokogiri -v <span class="s1">&#39;1.6.2&#39;</span><span class="sb">`</span> succeeds before bundling.</code></pre></div>

<p>I take the advice and run <code>gem install nokogiri -v '1.6.2'</code> which fails because it can’t find the libiconv native library.</p>

<div class="highlight"><pre><code class="bash">gem install nokogiri -v <span class="s1">&#39;1.6.2&#39;</span>
Building native extensions.  This could take a <span class="k">while</span>...
Building nokogiri using packaged libraries.
ERROR:  Error installing nokogiri:
	ERROR: Failed to build gem native extension.

    /Users/mahcloud/.rvm/rubies/ruby-1.9.2-p320/bin/ruby extconf.rb
Building nokogiri using packaged libraries.
-----
libiconv is missing.  please visit http://nokogiri.org/tutorials/installing_nokogiri.html <span class="k">for </span><span class="nb">help </span>with installing dependencies.
-----
*** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of
necessary libraries and/or headers.  Check the mkmf.log file <span class="k">for </span>more
details.  You may need configuration options.

Provided configuration options:
	--with-opt-dir
	--with-opt-include
	--without-opt-include<span class="o">=</span><span class="k">${</span><span class="nv">opt</span><span class="p">-dir</span><span class="k">}</span>/include
	--with-opt-lib
	--without-opt-lib<span class="o">=</span><span class="k">${</span><span class="nv">opt</span><span class="p">-dir</span><span class="k">}</span>/lib
	--with-make-prog
	--without-make-prog
	--srcdir<span class="o">=</span>.
	--curdir
	--ruby<span class="o">=</span>/Users/mahcloud/.rvm/rubies/ruby-1.9.2-p320/bin/ruby
	--help
	--clean
	--use-system-libraries
	--enable-static
	--disable-static
	--with-zlib-dir
	--without-zlib-dir
	--with-zlib-include
	--without-zlib-include<span class="o">=</span><span class="k">${</span><span class="nv">zlib</span><span class="p">-dir</span><span class="k">}</span>/include
	--with-zlib-lib
	--without-zlib-lib<span class="o">=</span><span class="k">${</span><span class="nv">zlib</span><span class="p">-dir</span><span class="k">}</span>/lib
	--enable-cross-build
	--disable-cross-build

extconf failed, <span class="nb">exit </span>code 1

Gem files will remain installed in /Users/mahcloud/.rvm/gems/ruby-1.9.2-p320@1kb-chef/gems/nokogiri-1.6.2 <span class="k">for </span>inspection.
Results logged to /Users/mahcloud/.rvm/gems/ruby-1.9.2-p320@1kb-chef/extensions/x86_64-darwin-13/1.9.1/nokogiri-1.6.2/gem_make.out</code></pre></div>

<p><a href="https://www.gnu.org/software/libiconv/">libiconv</a> is a library that converts string encodings from or to unicode. libiconv comes standard on my mac, but for some reason nokogiri thinks it is missing.</p>

<p>So we need install libiconv again and tell nokogiri where libiconv is. Some options for installing libiconv are macports and brew. I installed with brew. And then ran.</p>

<div class="highlight"><pre><code class="bash">gem install nokogiri -- --with-iconv-dir<span class="o">=</span>/usr/local/Cellar/libiconv/1.14/</code></pre></div>

<p>This installed successfully. This fixed the problem in my development environment for my site, but for the chef repository, it still doesn’t recognize that nokogiri is installed.</p>

<p>Next, I ran</p>

<div class="highlight"><pre><code class="bash">xcode-select --install</code></pre></div>

<p>This installs the command-line developer tools for mac, which includes libiconv. Install nokogiri version as normal and that took care of the problem.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/06/11/chef-server-provisioning/">Chef - Server Provisioning Software</a></h1>
		
		<div class="post-content"><p>Okay, today I’m wearing my chef loves bacon hat. Today’s goal is to get started with Chef for provisioning load balanced API servers.</p>

<p>I’ll be starting out on a <a href="http://railscasts.com/episodes/339-chef-solo-basics">railscast</a> video. Well this video is on chef-solo and I’ll be using chef server, so not as much help as I was hoping. Next I went through this <a href="http://gettingstartedwithchef.com/">tutorial</a>, but it just flat out didn’t work, so I stopped half way through. My boss suggested this <a href="https://learnchef.opscode.com/screencasts/spring-fundamentals/week-1/">video series</a>, but it is beyond boring and overly complex. We’ll be using <a href="http://www.getchef.com/">opscode</a> to host our chef server.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/06/10/rails-god-process-management/">Ruby God - Process Management</a></h1>
		
		<div class="post-content"><p>So I’m back after a few months.</p>

<p>The project I was working on that needed a custom install was not received well. Originally everyone liked it but when customers that didn’t understand it started to complain, management just wanted it shutdown. Bad data is better than no data at all I guess.</p>

<p>Well, I’m back and onto a new project that needs rails deployment. This time it is a reporting tools. In order to not slow down the live orders/quotes table with reporting, I’m building a seperate database of order/quote data that should be populated identical to the live database. I’m using <a href="http://www.rabbitmq.com/">rabbitMQ</a> to transfer a hash of the data when an order or quote is changed. This way it doesn’t slow down the transaction or database on the live site. The hash is put in a queue by the rabbit exchange. Our reporting application will then consume that data and save the calculations to a postgres database.</p>

<p>Now that we have all the background story covered, I’ve got the RoR application deploying live and to a beta staging environment. When I deploy to these boxes, I need a zero downtime switch to the new code. Since the reporting server is constantly consuming data from rabbitMQ, it would be very bad if it missed any of these queued items. I’ll be using <a href="http://godrb.com/">god</a> to keep the rabbitMQ listener up and running even during a code deployment. So, the line I need to add to my capistrano deployment is:</p>

<div class="highlight"><pre><code class="bash">sudo /var/god/.rvm/bin/god restart APP-NAME</code></pre></div>

<p>I’m having a little problem here.</p>

<div class="highlight"><pre><code class="bash">Command: /usr/bin/env sudo
DEBUG <span class="o">[]</span> 	usage: sudo -h <span class="p">|</span> -K <span class="p">|</span> -k <span class="p">|</span> -V
DEBUG <span class="o">[]</span> 	usage: sudo -v <span class="o">[</span>-g group<span class="o">]</span> <span class="o">[</span>-h host<span class="o">]</span> <span class="o">[</span>-p prompt<span class="o">]</span> <span class="o">[</span>-u user<span class="o">]</span>
DEBUG <span class="o">[]</span> 	usage: sudo -l <span class="o">[</span>-g group<span class="o">]</span> <span class="o">[</span>-h host<span class="o">]</span> <span class="o">[</span>-p prompt<span class="o">]</span> <span class="o">[</span>-U user<span class="o">]</span> <span class="o">[</span>-u user<span class="o">]</span>
DEBUG <span class="o">[]</span> 	  
DEBUG <span class="o">[]</span> 	          <span class="o">[</span><span class="nb">command</span><span class="o">]</span>
DEBUG <span class="o">[]</span> 	usage: sudo <span class="o">[</span>-r role<span class="o">]</span> <span class="o">[</span>-t <span class="nb">type</span><span class="o">]</span> <span class="o">[</span>-C num<span class="o">]</span> <span class="o">[</span>-g group<span class="o">]</span> <span class="o">[</span>-h host<span class="o">]</span> <span class="o">[</span>-p
DEBUG <span class="o">[]</span> 	  
DEBUG <span class="o">[]</span> 	          prompt<span class="o">]</span> <span class="o">[</span>-u user<span class="o">]</span> <span class="o">[</span><span class="nv">VAR</span><span class="o">=</span>value<span class="o">]</span> <span class="o">[</span>-i<span class="p">|</span>-s<span class="o">]</span> <span class="o">[</span>&lt;<span class="nb">command</span>&gt;<span class="o">]</span>
DEBUG <span class="o">[]</span> 	usage: sudo -e <span class="o">[</span>-r role<span class="o">]</span> <span class="o">[</span>-t <span class="nb">type</span><span class="o">]</span> <span class="o">[</span>-C num<span class="o">]</span> <span class="o">[</span>-g group<span class="o">]</span> <span class="o">[</span>-h host<span class="o">]</span> <span class="o">[</span>-p
DEBUG <span class="o">[]</span> 	    
DEBUG <span class="o">[]</span> 	        prompt<span class="o">]</span> <span class="o">[</span>-u user<span class="o">]</span> file ...
cap aborted!
SSHKit::Command::Failed: sudo <span class="nb">exit </span>status: 1
sudo stdout: Nothing written
sudo stderr: usage: sudo -h <span class="p">|</span> -K <span class="p">|</span> -k <span class="p">|</span> -V
/gems/sshkit-1.4.0/lib/sshkit/command.rb:98:in <span class="sb">`</span><span class="nv">exit_status</span><span class="o">=</span><span class="err">&#39;</span></code></pre></div>

<p>First thought, this exact script does work on the server by manually entering it.</p>

<p>Next, what is <a href="https://github.com/capistrano/sshkit">SSHKit</a>?
It is a gem capistrano uses to make ssh connections to all the different environments I will be deploying to.</p>

<p>Exit status 1 just means there was an error with no more explanation than that.
So, I’m a little stuck here. Bash doesn’t give any specific error code. I would guess it has something to do using sudo without a password on an ssh connection using an ssh-key for authentication. I asked my boss if he had any suggestions. He said <code>does the deploy user have password-less sudo rights?</code>. It looks like there is something called pty and tty. So what are they and what’s the difference?
I found <a href="http://ubuntuforums.org/archive/index.php/t-833765.html">TTY and PTY</a> and <a href="http://stackoverflow.com/questions/4426280/what-do-pty-and-tty-mean">Teletype</a>. Still very confused why I would need a virtual terminal for deploying and if I capistrano needs a virtual terminal to run commands how it did anything with out it. Maybe it was already using one and I can just set it to a different one.</p>

<p>Okay, so I still feel lost enough not to know where to go. Since, pty doesn’t sound harmful at all, I guess I will just turn it on and see what happens.</p>

<p>Turning on pty with <code>set :pty, true</code> or <code>set :tty, true</code> in config/deploy.rb file gave the same results.</p>

<p>Okay, I think was on the wrong track with the pty thing. I had to add my user as a <a href="http://askubuntu.com/questions/192050/how-to-run-sudo-command-with-no-password">passwordless sudo</a> user for deploying. That took care of the problem.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/04/09/rails-app-deploy/">First rails deploy</a></h1>
		
		<div class="post-content"><p>I’ve been working on learning how to deploy a rails app without the help of <a href="https://www.heroku.com">Heroku</a>.
You might ask why I would want to do that.
That’s a really good question that I ask myself everytime I can’t figure things out for hours on end.
I won’t answer that question now.
I’ll leave that for the last post I make on RailsDeploy.</p>

<p>My teacher is the author of <a href="https://railsdeploymentbook.com/">Fearless Rails Deployment</a>.
If you preorder his book, he’ll let you view the draft so far.
I don’t want to give away anything that is in his book, so I’m just gonna skim over what I’ve learned.</p>

<p>I deployed using capistrano.
This will create the capistrano files:</p>

<div class="highlight"><pre><code class="bash">cap install</code></pre></div>

<p>To use capistrano you’ll need to be able to ssh authenticate with ssh key instead of password.
<a href="http://gorails.com/deploy/ubuntu/12.04">Here</a> is a great tutorial on how to do that.</p>

<p>First, I needed to install unicorn as my rails server.
This part was a lot easier than I thought it was going to be.
After adding the gem and installing it, I just made a unicorn config file and ran unicorn.</p>

<div class="highlight"><pre><code class="bash">vim /etc/unicorn/mahcloud.rb</code></pre></div>

<div class="highlight"><pre><code class="ruby"><span class="n">pid</span> <span class="s1">&#39;/home/root/mahcloud/tmp/unicorn.pid&#39;</span>
<span class="n">working_directory</span> <span class="s1">&#39;/home/root/mahcloud/&#39;</span></code></pre></div>

<p>The config file has a little more to it than that.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/03/18/javascript-canvas-game-pokemon/">Javascript Canvas Game Pokemon</a></h1>
		
		<div class="post-content"><p>Wouldn’t it be more fun if we were dealing with Pokemon instead of an Ogre?</p>

<p><img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/1.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/2.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/3.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/4.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/5.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/6.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/7.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/8.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/9.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/10.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/11.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/12.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/13.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/14.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/15.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/16.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/17.png?raw=true" alt="Background Image" />
<img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/pokemon/18.png?raw=true" alt="Background Image" /></p>

<p>These are the image dimensions for the pokemon.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">pokemon_dimensions</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span>
	<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="p">);</span></code></pre></div>

<p>Add this to your spawnMonster function.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">pokemon</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">18</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">monsterImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;images/pokemon/&quot;</span><span class="o">+</span><span class="nx">pokemon</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">;</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">pokemon_dimensions</span><span class="p">[</span><span class="nx">pokemon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">pokemon_dimensions</span><span class="p">[</span><span class="nx">pokemon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span></code></pre></div>

<p>Let’s rename some methods.
monstersSlain should be pokemonCaught.
slayMonster should be catchPokemon.</p>

<p>You can <a href="https://github.com/mahcloud/SimpleCanvasGame/tree/add-hero">download</a> this example.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/03/18/javascript-canvas-game-monster-gates/">Javascript Canvas Game Monster Gates</a></h1>
		
		<div class="post-content"><p>Monsters should spawn randomly at gate opening in arena.
First, add the gates array.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">gates</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span>
		<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
		<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
		<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">),</span>
		<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
	<span class="p">);</span></code></pre></div>

<p>Then we want to spawn a monster randomly.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">spawnMonster</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">gate</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="nx">monster</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">gates</span><span class="p">[</span><span class="nx">gate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">monster</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">gates</span><span class="p">[</span><span class="nx">gate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span></code></pre></div>

<p>And change this in the slayMonster function</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">monster</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span></code></pre></div>

<p>for</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">spawnMonster</span><span class="p">();</span></code></pre></div>

<p>Added bonus, we can have the monster start at a spawn point by adding.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">spawnMonster</span><span class="p">();</span></code></pre></div>

<p>And change the monster array values.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">monster</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">;</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">;</span></code></pre></div>

<p>This means that the monster will be drawn off the screen before it is spawned.</p>

<p>You can <a href="https://github.com/mahcloud/SimpleCanvasGame/tree/monster-gates">download</a> this example.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/03/18/javascript-canvas-game-slay-monster/">Javascript Canvas Game Slay Monster</a></h1>
		
		<div class="post-content"><p>Slaying monsters in our javascript arena.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">slayMonster</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">isTouching</span><span class="p">(</span><span class="nx">hero</span><span class="p">,</span> <span class="nx">monster</span><span class="p">))</span> <span class="p">{</span>
		<span class="nx">monster</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
		<span class="nx">monster</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">isTouching</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	<span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">width</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">width</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">height</span><span class="p">)))</span> <span class="p">{</span>
		<span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">};</span></code></pre></div>

<p>Slay monster function simply checks if the hero and monster are touching and then respawns the monster at location 100, 100.</p>

<p>The slayMonster function should be called in the main function.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">slayMonster</span><span class="p">();</span></code></pre></div>

<p>It’s more fun if we had some stats on how many monsters we have slain.
Add a variable to the hero array to keep track of how many monsters have been slain.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">hero</span><span class="p">.</span><span class="nx">monstersSlain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></code></pre></div>

<p>Now in the slayMonsters if isTouching block add an incrementer.</p>

<div class="highlight"><pre><code class="javascript"><span class="o">++</span><span class="nx">hero</span><span class="p">.</span><span class="nx">monstersSlain</span><span class="p">;</span></code></pre></div>

<p>We need to show this on the screen.
Add an HTML element to store the stat in.
We’ll also need jQuery, a helpful javascript library.</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;monsters_slain_header&quot;</span><span class="nt">&gt;</span>
	<span class="nt">&lt;span&gt;</span>Monsters Slain: <span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;monsters_slain&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></div>

<p>To push the monsters slain count to the html element, add this to your render function.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#monsters_slain&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">hero</span><span class="p">.</span><span class="nx">monstersSlain</span><span class="p">);</span></code></pre></div>

<p>Let’s add some styling to our stat bar.</p>

<div class="highlight"><pre><code class="css"><span class="nf">#monsters_slain_header</span> <span class="p">{</span> <span class="k">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span> <span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span> <span class="k">font-size</span><span class="o">:</span> <span class="m">18px</span><span class="p">;</span> <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span> <span class="m">15px</span><span class="p">;</span> <span class="p">}</span></code></pre></div>

<p>You can <a href="https://github.com/mahcloud/SimpleCanvasGame/tree/slay-monster">download</a> this example.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/03/16/javascript-canvas-game-add-monster/">Javascript Canvas Game Add Monster</a></h1>
		
		<div class="post-content"><p>Let’s add a monster to our javascript arena.
You’ll need a monster.png image.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">monsterImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
<span class="nx">monsterImage</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">monsterImage</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">monsterImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;images/monster.png&quot;</span><span class="p">;</span></code></pre></div>

<p><img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/monster.png?raw=true" alt="Background Image" /></p>

<p>Next, let’s make them move.
We’ll make it so we can control the hero’s movement.
First, we need to update the images so they load every time the hero and monster move.
Change the image code to:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">bgImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
<span class="nx">bgImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;images/canvas_background.png&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">heroImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
<span class="nx">heroImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;images/hero.png&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">monsterImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
<span class="nx">monsterImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;images/monster.png&quot;</span><span class="p">;</span></code></pre></div>

<p>Basically removing the onload functions.</p>

<p>We will then reload the images every few miliseconds with:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">hero</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">hero</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
<span class="nx">hero</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
<span class="nx">hero</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">hero</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
<span class="nx">hero</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">hero</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">monster</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">32</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
	<span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">bgImage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">monsterImage</span><span class="p">,</span> <span class="nx">monster</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">monster</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
	<span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">heroImage</span><span class="p">,</span> <span class="nx">hero</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">hero</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">main</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">render</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">setInterval</span><span class="p">(</span><span class="nx">main</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span></code></pre></div>

<p>Now let’s make our monster move.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">moveMonster</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">monster</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">monster</span><span class="p">.</span><span class="nx">xDirection</span><span class="p">;</span>
	<span class="nx">monster</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">monster</span><span class="p">.</span><span class="nx">yDirection</span><span class="p">;</span>
	<span class="nx">resetObjectLocation</span><span class="p">(</span><span class="nx">monster</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">updateMonsterDirection</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">monster</span><span class="p">.</span><span class="nx">xDirection</span> <span class="o">=</span> <span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">monster</span><span class="p">.</span><span class="nx">speed</span><span class="p">;</span>
	<span class="nx">monster</span><span class="p">.</span><span class="nx">yDirection</span><span class="o">=</span> <span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">monster</span><span class="p">.</span><span class="nx">speed</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">resetObjectLocation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">object</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">object</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">object</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span> <span class="p">{</span>
		<span class="nx">object</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">object</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">object</span><span class="p">.</span><span class="nx">width</span><span class="p">))</span> <span class="p">{</span>
		<span class="nx">object</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">object</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>And add the following to the main method.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">moveMonster</span><span class="p">();</span></code></pre></div>

<p>Add the following to the monster array.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">monster</span><span class="p">.</span><span class="nx">speed</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">xDirection</span> <span class="o">=</span> <span class="nx">monster</span><span class="p">.</span><span class="nx">speed</span><span class="p">;</span>
<span class="nx">monster</span><span class="p">.</span><span class="nx">yDirection</span> <span class="o">=</span> <span class="nx">monster</span><span class="p">.</span><span class="nx">speed</span><span class="p">;</span></code></pre></div>

<p>This goes at the bottom of your file to tell the monster to change direction every half second</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">setInterval</span><span class="p">(</span><span class="nx">updateMonsterDirection</span><span class="p">,</span> <span class="mi">500</span><span class="p">;</span></code></pre></div>

<p>But what if we wanted to control the hero using the arrow keys?
It would be the same logic just based on input from the keyboard.
Here’s how we receive input from the keyboard.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">keysDown</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">keysDown</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keyup&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">delete</span> <span class="nx">keysDown</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">];</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">moveHero</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="mi">38</span> <span class="k">in</span> <span class="nx">keysDown</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Player holding up</span>
		<span class="nx">hero</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">hero</span><span class="p">.</span><span class="nx">speed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="mi">40</span> <span class="k">in</span> <span class="nx">keysDown</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Player holding down</span>
		<span class="nx">hero</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">hero</span><span class="p">.</span><span class="nx">speed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="mi">37</span> <span class="k">in</span> <span class="nx">keysDown</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Player holding left</span>
		<span class="nx">hero</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">hero</span><span class="p">.</span><span class="nx">speed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="mi">39</span> <span class="k">in</span> <span class="nx">keysDown</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Player holding right</span>
		<span class="nx">hero</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">hero</span><span class="p">.</span><span class="nx">speed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nx">resetObjectLocation</span><span class="p">(</span><span class="nx">hero</span><span class="p">);</span>
<span class="p">};</span></code></pre></div>

<p>Don’t forget to add speed to your hero array.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">hero</span><span class="p">.</span><span class="nx">speed</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span></code></pre></div>

<p>And add moveHero method call to your main method.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">moveHero</span><span class="p">();</span></code></pre></div>

<p>You can <a href="https://github.com/mahcloud/SimpleCanvasGame/tree/monster">download</a> this example.</p>

</div>
	</article>

	<article class="post">
		
			<h1><a href="/2014/03/16/javascript-canvas-game-add-a-hero/">Javascript Canvas Game Add a Hero</a></h1>
		
		<div class="post-content"><p>Let’s add a hero to our javascript arena.
You’ll need a hero.png image</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">heroImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
<span class="nx">heroImage</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">heroImage</span><span class="p">,</span> <span class="mi">474</span><span class="p">,</span> <span class="mi">287</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">heroImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;images/hero.png&quot;</span><span class="p">;</span></code></pre></div>

<p><img src="https://github.com/mahcloud/SimpleCanvasGame/blob/master/images/hero.png?raw=true" alt="Background Image" /></p>

<p>You can <a href="https://github.com/mahcloud/SimpleCanvasGame/tree/add-hero">download</a> this example.</p>

</div>
	</article>



	<div class="postnavigation">
		
			<span class="nope left">&larr; Newer</span>
		

		<span class="pages">Page 1 of 2</span>

		
			<a class="next right" href="/page2/">Older &rarr;</a>
		
	</div>

			</div>

		</div>

		<footer id="footer">
			<p class="copyright">Copyright &copy; 2014 Mike Hoffert. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="http://www.webmaster-source.com">Matt Harzewski</a></p>
		</footer>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
		<script src="/assets/js/jquery.mobilemenu.min.js"></script>

		<script>
			$(document).ready(function(){
				$('#sidebar nav ul').mobileMenu({'topOptionText': 'Menu', 'prependTo': '#sidebar nav'});
			});
		</script>
	</body>
</html>